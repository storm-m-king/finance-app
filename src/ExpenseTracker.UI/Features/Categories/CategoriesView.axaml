<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:svg="clr-namespace:Avalonia.Svg.Skia;assembly=Avalonia.Svg.Skia"
             xmlns:shapes="clr-namespace:Avalonia.Controls.Shapes;assembly=Avalonia.Controls"
             xmlns:conv="clr-namespace:ExpenseTracker.UI.Converters"
             x:Class="ExpenseTracker.UI.Features.Categories.CategoriesView">

  <!-- Page scroll (the modal overlay sits on top via Grid row/children order) -->
  <Grid>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled">
      <Border Padding="0,0,12,24">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto"
              RowSpacing="18">

          <!-- Header + Add button -->
          <Grid Grid.Row="0" ColumnDefinitions="*,Auto" VerticalAlignment="Center">
            <StackPanel Grid.Column="0" Spacing="6">
              <TextBlock Text="Categories"
                         FontSize="32"
                         FontWeight="Bold" />
              <TextBlock Text="Manage transaction categories"
                         Classes="muted" />
            </StackPanel>

            <Button Grid.Column="1"
                    Background="{DynamicResource Blue}"
                    Foreground="White"
                    CornerRadius="12"
                    Padding="14,10"
                    FontWeight="SemiBold"
                    Command="{Binding OpenCreate}">
              <Grid ColumnDefinitions="Auto,Auto"
                    VerticalAlignment="Center">

                <TextBlock Grid.Column="0"
                           Text="+"
                           FontSize="16"
                           VerticalAlignment="Center"
                           Margin="0,0,6,0"/>

                <TextBlock Grid.Column="1"
                           Text="Add Category"
                           VerticalAlignment="Center"/>
              </Grid>
            </Button>
          </Grid>

          <!-- Income section -->
          <Border Grid.Row="1" Classes="card">
            <StackPanel Spacing="14">

              <TextBlock Text="Income"
                         FontSize="18"
                         FontWeight="Bold" />

              <ItemsControl ItemsSource="{Binding IncomeCategories}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"
                               ItemWidth="420"
                               ItemHeight="86"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Top"
                               Margin="0"
                               />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Background="#0B1220"
                            BorderBrush="#1C2A40"
                            BorderThickness="1"
                            CornerRadius="14"
                            Padding="16,14"
                            Margin="0,0,16,16">
                      <Grid ColumnDefinitions="*,Auto" RowDefinitions="*,Auto">

                        <!-- Name + lock -->
                        <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                          <TextBlock Text="{Binding Name}"
                                     FontWeight="SemiBold"
                                     FontSize="14" />

                          <svg:Svg Path="/Assets/Icons/lock.svg"
                                   Width="16"
                                   Height="16"
                                   Stretch="Uniform"
                                   IsVisible="{Binding IsLocked}" />
                        </StackPanel>

                        <!-- Edit/Delete actions -->
                        <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" IsVisible="{Binding CanEdit}" VerticalAlignment="Top">
                          <Button Classes="iconButton"
                                  BorderThickness="0"
                                  Padding="6"
                                  Command="{Binding DataContext.OpenEdit, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  CommandParameter="{Binding}">
                            <!-- SVG if present -->
                            <svg:Svg Path="/Assets/Icons/edit.svg"
                                     Width="16" Height="16"
                                     Stretch="Uniform"
                                     IsVisible="True"/>
                          </Button>

                          <Button Classes="iconButton"
                                  BorderThickness="0"
                                  Padding="6"
                                  Command="{Binding DataContext.OpenDelete, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  CommandParameter="{Binding}">
                            <svg:Svg Path="/Assets/Icons/trash.svg"
                                     Width="16" Height="16"
                                     Stretch="Uniform"
                                     IsVisible="True"/>
                          </Button>
                        </StackPanel>
                        <TextBlock Grid.Column="0" Grid.Row="1"
                                   Text="{Binding TransactionCountText}"
                                   Classes="muted"
                                   FontSize="12"
                                   VerticalAlignment="Bottom"
                                   Margin="0,0,0,2"/>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

            </StackPanel>
          </Border>

          <!-- Expense section -->
          <Border Grid.Row="2" Classes="card">
            <StackPanel Spacing="14">

              <TextBlock Text="Expense"
                         FontSize="18"
                         FontWeight="Bold" />

              <ItemsControl ItemsSource="{Binding ExpenseCategories}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"
                               ItemWidth="420"
                               ItemHeight="86"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Top"
                               Margin="0"
                               />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Background="#0B1220"
                            BorderBrush="#1C2A40"
                            BorderThickness="1"
                            CornerRadius="14"
                            Padding="16,14"
                            Margin="0,0,16,16">
                      <Grid ColumnDefinitions="*,Auto" RowDefinitions="*,Auto">

                        <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                          <TextBlock Text="{Binding Name}"
                                     FontWeight="SemiBold"
                                     FontSize="14" />

                          <svg:Svg Path="/Assets/Icons/lock.svg"
                                   Width="16"
                                   Height="16"
                                   Stretch="Uniform"
                                   IsVisible="{Binding IsLocked}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" IsVisible="{Binding CanEdit}" VerticalAlignment="Top">
                          <Button Classes="iconButton"
                                  BorderThickness="0"
                                  Padding="6"
                                  Command="{Binding DataContext.OpenEdit, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  CommandParameter="{Binding}">
                            <svg:Svg Path="/Assets/Icons/edit.svg"
                                     Width="16" Height="16"
                                     Stretch="Uniform"
                                     IsVisible="True"/>
                          </Button>

                          <Button Classes="iconButton"
                                  BorderThickness="0"
                                  Padding="6"
                                  Command="{Binding DataContext.OpenDelete, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  CommandParameter="{Binding}">
                            <svg:Svg Path="/Assets/Icons/trash.svg"
                                     Width="16" Height="16"
                                     Stretch="Uniform"
                                     IsVisible="True"/>
                          </Button>
                        </StackPanel>

                        <TextBlock Grid.Column="0" Grid.Row="1"
                                   Text="{Binding TransactionCountText}"
                                   Classes="muted"
                                   FontSize="12"
                                   VerticalAlignment="Bottom"
                                   Margin="0,0,0,2"/>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

            </StackPanel>
          </Border>

          <!-- Transfer section -->
          <Border Grid.Row="3" Classes="card">
            <StackPanel Spacing="14">

              <TextBlock Text="Transfer"
                         FontSize="18"
                         FontWeight="Bold" />

              <ItemsControl ItemsSource="{Binding TransferCategories}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"
                               ItemWidth="420"
                               ItemHeight="86"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Top"
                               Margin="0"
                               />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Background="#0B1220"
                            BorderBrush="#1C2A40"
                            BorderThickness="1"
                            CornerRadius="14"
                            Padding="16,14"
                            Margin="0,0,16,16">
                      <Grid ColumnDefinitions="*,Auto" RowDefinitions="*,Auto">

                        <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                          <TextBlock Text="{Binding Name}"
                                     FontWeight="SemiBold"
                                     FontSize="14" />

                          <svg:Svg Path="/Assets/Icons/lock.svg"
                                   Width="16"
                                   Height="16"
                                   Stretch="Uniform"
                                   IsVisible="{Binding IsLocked}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" IsVisible="{Binding CanEdit}" VerticalAlignment="Top">
                          <Button Classes="iconButton"
                                  BorderThickness="0"
                                  Padding="6"
                                  Command="{Binding DataContext.OpenEdit, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  CommandParameter="{Binding}">
                            <svg:Svg Path="/Assets/Icons/edit.svg"
                                     Width="16" Height="16"
                                     Stretch="Uniform"
                                     IsVisible="True"/>
                          </Button>

                          <Button Classes="iconButton"
                                  BorderThickness="0"
                                  Padding="6"
                                  Command="{Binding DataContext.OpenDelete, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  CommandParameter="{Binding}">
                            <svg:Svg Path="/Assets/Icons/trash.svg"
                                     Width="16" Height="16"
                                     Stretch="Uniform"
                                     IsVisible="True"/>
                          </Button>
                        </StackPanel>

                        <TextBlock Grid.Column="0" Grid.Row="1"
                                   Text="{Binding TransactionCountText}"
                                   Classes="muted"
                                   FontSize="12"
                                   VerticalAlignment="Bottom"
                                   Margin="0,0,0,2"/>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

            </StackPanel>
          </Border>

        </Grid>
      </Border>
    </ScrollViewer>

    <!-- ========================= -->
    <!-- MODAL OVERLAY (Create/Edit/Delete) -->
    <!-- ========================= -->
    <Border IsVisible="{Binding IsAnyModalOpen}" ZIndex="50">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
          <GradientStop Color="#7A020617" Offset="0"/>
          <GradientStop Color="#9A020A1A" Offset="1"/>
        </LinearGradientBrush>
      </Border.Background>


      <!-- click-blocking full overlay -->
      <Grid HorizontalAlignment="Center"
            VerticalAlignment="Center">

        <!-- ===== Create/Edit Modal ===== -->
        <Border Width="560"
                CornerRadius="18"
                Padding="22"
                BorderThickness="1"
                BorderBrush="#2A4F8F"
                IsVisible="{Binding IsUpsertModalOpen}">

          <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
              <GradientStop Color="#13294F" Offset="0"/>
              <GradientStop Color="#0D1F3D" Offset="1"/>
            </LinearGradientBrush>
          </Border.Background>
          
          <Border.Effect>
            <DropShadowEffect BlurRadius="40"
                              Opacity="0.55"/>
          </Border.Effect>
          
          <Grid RowDefinitions="Auto,Auto,Auto,Auto"
                ColumnDefinitions="*,Auto"
                RowSpacing="14"
                ColumnSpacing="12">

            <!-- Title + close -->
            <StackPanel Grid.Row="0" Grid.Column="0" Spacing="4">
              <TextBlock Text="{Binding UpsertTitle}"
                         FontSize="18"
                         FontWeight="Bold"/>
              <TextBlock Text="{Binding UpsertSubtitle}"
                         Classes="muted"/>
            </StackPanel>

            <Button Grid.Row="0" Grid.Column="1"
                    Background="Transparent"
                    BorderThickness="0"
                    Command="{Binding CloseModal}">
              <TextBlock Text="✕" Opacity="0.8"/>
            </Button>

            <!-- Category Name -->
            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Spacing="6">
              <TextBlock Text="Category Name"
                         FontWeight="SemiBold"
                         FontSize="12"
                         Opacity="0.9"/>
              <TextBox Text="{Binding CategoryName}"
                       Watermark="Enter category name"
                       CornerRadius="10"
                       Padding="12,10"/>
            </StackPanel>

            <!-- Type -->
            <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Spacing="6">
              <TextBlock Text="Type"
                         FontWeight="SemiBold"
                         FontSize="12"
                         Opacity="0.9"/>
              <ComboBox ItemsSource="{Binding CategoryTypes}"
                        SelectedItem="{Binding SelectedType}"
                        CornerRadius="10"
                        Padding="10,8"/>
            </StackPanel>

            <!-- Buttons -->
            <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Spacing="12">
              <Button Classes="secondaryWide"
                      Command="{Binding CloseModal}"
                      Padding="14,10">
                Cancel
              </Button>

              <Button Background="{DynamicResource Blue}"
                      Foreground="White"
                      CornerRadius="12"
                      Padding="16,10"
                      FontWeight="SemiBold"
                      Command="{Binding SaveUpsert}">
                <TextBlock Text="{Binding UpsertPrimaryButtonText}" />
              </Button>
            </StackPanel>

          </Grid>
        </Border>

        <!-- ===== Delete Confirm Modal ===== -->
        <Border Width="560"
                CornerRadius="18"
                Padding="22"
                BorderThickness="1"
                BorderBrush="#2A4F8F"
                IsVisible="{Binding IsDeleteModalOpen}">

          <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
              <GradientStop Color="#13294F" Offset="0"/>
              <GradientStop Color="#0D1F3D" Offset="1"/>
            </LinearGradientBrush>
          </Border.Background>

          <Border.Effect>
            <DropShadowEffect BlurRadius="40"
                              Opacity="0.55"/>
          </Border.Effect>
          
  <Grid RowDefinitions="Auto,Auto,Auto"
        ColumnDefinitions="Auto,*,Auto"
        RowSpacing="16"
        ColumnSpacing="14">

    <!-- Left: danger badge -->
    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
            Width="44" Height="44"
            CornerRadius="22"
            Background="#2A1620"
            BorderBrush="#5A2436"
            BorderThickness="1"
            VerticalAlignment="Top">
      <TextBlock Text="!"
                 FontSize="18"
                 FontWeight="Bold"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Foreground="#FF6B8A"/>
    </Border>

    <!-- Title + subtitle -->
    <StackPanel Grid.Row="0" Grid.Column="1" Spacing="4">
      <TextBlock Text="Delete Category"
                 FontSize="20"
                 FontWeight="Bold"/>
      <TextBlock Text="This action cannot be undone."
                 Classes="muted"/>
    </StackPanel>

    <!-- Close -->
    <Button Grid.Row="0" Grid.Column="2"
            Classes="iconButton"
            Background="Transparent"
            BorderThickness="0"
            Command="{Binding CloseModal}">
      <TextBlock Text="✕" Opacity="0.8"/>
    </Button>

    <!-- Body -->
    <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Spacing="12">

      <!-- Main question -->
      <TextBlock Text="{Binding DeletePromptLine1}"
                 FontSize="15"
                 FontWeight="SemiBold"/>

      <!-- Consequence panel -->
      <Border Background="#101C33"
              BorderBrush="#2B3B5A"
              BorderThickness="1"
              CornerRadius="14"
              Padding="14">
        <TextBlock Text="{Binding DeletePromptLine2}"
                   Classes="muted"/>
      </Border>

    </StackPanel>

    <!-- Buttons -->
    <Grid Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2"
          ColumnDefinitions="*,Auto,Auto"
          ColumnSpacing="12"
          VerticalAlignment="Center">

      <!-- Spacer -->
      <Border Grid.Column="0"/>

      <Button Grid.Column="1"
              Classes="secondaryWide"
              Command="{Binding CloseModal}"
              Padding="16,10"
              CornerRadius="12">
        Cancel
      </Button>

      <!-- Danger action -->
      <Button Grid.Column="2"
              Background="#B42318"
              Foreground="White"
              CornerRadius="12"
              Padding="18,10"
              FontWeight="SemiBold"
              Command="{Binding ConfirmDelete}">
        Delete
      </Button>

    </Grid>

  </Grid>
</Border>


      </Grid>
    </Border>

  </Grid>
</UserControl>

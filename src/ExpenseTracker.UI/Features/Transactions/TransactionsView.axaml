<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="ExpenseTracker.UI.Features.Transactions.TransactionsView">

  <Grid>

  <ScrollViewer VerticalScrollBarVisibility="Auto"
                HorizontalScrollBarVisibility="Disabled">

    <Border Padding="0,0,12,24">
      <Grid RowDefinitions="Auto,Auto,Auto"
            RowSpacing="18">

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="6">
            <TextBlock Text="Transactions"
                       FontSize="32"
                       FontWeight="Bold" />
            <TextBlock Text="View and filter all imported transactions"
                       Classes="muted" />
        </StackPanel>

        <!-- Filters card -->
        <Border Grid.Row="1" Classes="card">
          <StackPanel Spacing="14">

            <!-- Search bar -->
            <TextBox Text="{Binding SearchText}"
                     Watermark="Search transactions by description, amount, category..."
                     CornerRadius="10"
                     Padding="14,10"
                     FontSize="14"/>

            <!-- Filter row: multi-select flyout buttons + date range -->
            <Grid ColumnDefinitions="*,*,*"
                  ColumnSpacing="12">

              <!-- Category multi-select -->
              <StackPanel Grid.Column="0" Spacing="4">
                <TextBlock Text="Category"
                           Classes="muted"
                           FontSize="12"
                           FontWeight="SemiBold"/>
                <Button Background="#0B1220"
                        BorderBrush="#1C2A40"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="10,8"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        FontWeight="SemiBold">
                  <TextBlock Text="{Binding CategoryFilterLabel}" Classes="muted"/>
                  <Button.Flyout>
                    <Flyout Placement="BottomEdgeAlignedLeft">
                      <Border MinWidth="200" MaxHeight="280">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                          <ItemsControl ItemsSource="{Binding CategoryFilters}">
                            <ItemsControl.ItemTemplate>
                              <DataTemplate>
                                <CheckBox IsChecked="{Binding IsChecked}"
                                          Content="{Binding Label}"
                                          Margin="4,2"
                                          FontWeight="SemiBold"/>
                              </DataTemplate>
                            </ItemsControl.ItemTemplate>
                          </ItemsControl>
                        </ScrollViewer>
                      </Border>
                    </Flyout>
                  </Button.Flyout>
                </Button>
              </StackPanel>

              <!-- Status multi-select -->
              <StackPanel Grid.Column="1" Spacing="4">
                <TextBlock Text="Status"
                           Classes="muted"
                           FontSize="12"
                           FontWeight="SemiBold"/>
                <Button Background="#0B1220"
                        BorderBrush="#1C2A40"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="10,8"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        FontWeight="SemiBold">
                  <TextBlock Text="{Binding StatusFilterLabel}" Classes="muted"/>
                  <Button.Flyout>
                    <Flyout Placement="BottomEdgeAlignedLeft">
                      <Border MinWidth="200">
                        <ItemsControl ItemsSource="{Binding StatusFilters}">
                          <ItemsControl.ItemTemplate>
                            <DataTemplate>
                              <CheckBox IsChecked="{Binding IsChecked}"
                                        Content="{Binding Label}"
                                        Margin="4,2"
                                        FontWeight="SemiBold"/>
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                      </Border>
                    </Flyout>
                  </Button.Flyout>
                </Button>
              </StackPanel>

              <!-- Account multi-select -->
              <StackPanel Grid.Column="2" Spacing="4">
                <TextBlock Text="Account"
                           Classes="muted"
                           FontSize="12"
                           FontWeight="SemiBold"/>
                <Button Background="#0B1220"
                        BorderBrush="#1C2A40"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="10,8"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        FontWeight="SemiBold">
                  <TextBlock Text="{Binding AccountFilterLabel}" Classes="muted"/>
                  <Button.Flyout>
                    <Flyout Placement="BottomEdgeAlignedLeft">
                      <Border MinWidth="200">
                        <ItemsControl ItemsSource="{Binding AccountFilters}">
                          <ItemsControl.ItemTemplate>
                            <DataTemplate>
                              <CheckBox IsChecked="{Binding IsChecked}"
                                        Content="{Binding Label}"
                                        Margin="4,2"
                                        FontWeight="SemiBold"/>
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                      </Border>
                    </Flyout>
                  </Button.Flyout>
                </Button>
              </StackPanel>
            </Grid>

            <!-- Date range presets -->
            <StackPanel Spacing="4">
              <TextBlock Text="Date Range"
                         Classes="muted"
                         FontSize="12"
                         FontWeight="SemiBold"/>
              <ItemsControl ItemsSource="{Binding DatePresets}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Button Content="{Binding Label}"
                            Background="#0B1220"
                            BorderBrush="#1C2A40"
                            BorderThickness="1"
                            CornerRadius="10"
                            Padding="12,8"
                            Margin="0,4,8,4"
                            FontWeight="SemiBold"
                            FontSize="12"
                            Command="{Binding $parent[ItemsControl].DataContext.SelectPresetCommand}"
                            CommandParameter="{Binding}"/>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

              <!-- Active date range indicator -->
              <TextBlock Text="{Binding DateRangeLabel}"
                         FontSize="13"
                         FontWeight="SemiBold"
                         Foreground="{DynamicResource Blue}"
                         IsVisible="{Binding DateRangeLabel, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                         Margin="0,4,0,0"/>
            </StackPanel>

            <!-- Options + Clear Filters -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,2,0,0">
              <CheckBox Grid.Column="0"
                        IsChecked="{Binding ShowSourceFile}"
                        Content="Include Source File"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center"/>

              <Button Grid.Column="1"
                      Background="#1C2A40"
                      Foreground="#A7B4D1"
                      CornerRadius="12"
                      Padding="14,10"
                      FontWeight="SemiBold"
                      Cursor="Hand"
                      VerticalAlignment="Center"
                      IsEnabled="{Binding HasActiveFilters}"
                      Command="{Binding ClearFilters}">
                <Button.Styles>
                  <Style Selector="Button:disabled">
                    <Setter Property="Opacity" Value="0"/>
                  </Style>
                </Button.Styles>
                âœ•  Clear Filters
              </Button>
            </Grid>

          </StackPanel>
        </Border>

        <!-- Transactions table card -->
        <Border Grid.Row="2" Classes="card">
          <StackPanel Spacing="14">

            <TextBlock Text="{Binding SummaryText}"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Classes="muted"/>

            <!-- Table shell -->
            <Border Background="#0B1220"
                    BorderBrush="#1C2A40"
                    BorderThickness="1"
                    CornerRadius="14"
                    ClipToBounds="True">

              <Grid RowDefinitions="Auto,*">

                <!-- Header row (without source file) -->
                <Border Grid.Row="0"
                        Background="#101C33"
                        BorderBrush="#1C2A40"
                        BorderThickness="0,0,0,1"
                        Padding="18,14"
                        IsVisible="{Binding !ShowSourceFile}">
                  <Grid ColumnDefinitions="1.2*,2.5*,1.2*,1.8*,1.5*,1.3*,Auto"
                        ColumnSpacing="12">
                    <Button Grid.Column="0" Content="{Binding DateHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Date"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="1" Content="{Binding DescriptionHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Description"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="2" Content="{Binding AmountHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Amount"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                            HorizontalAlignment="Right" HorizontalContentAlignment="Right"/>
                    <Button Grid.Column="3" Content="{Binding CategoryHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Category"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                            Margin="8,0,0,0"/>
                    <Button Grid.Column="4" Content="{Binding AccountHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Account"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="5" Content="{Binding StatusHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Status"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                            HorizontalAlignment="Center" HorizontalContentAlignment="Center"/>
                    <Button Grid.Column="6" Content="{Binding NotesHeader}"
                               Command="{Binding SortByColumnCommand}" CommandParameter="Notes"
                               Classes="muted" FontWeight="SemiBold"
                               Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                               HorizontalAlignment="Center"
                               Width="54"/>
                  </Grid>
                </Border>

                <!-- Header row (with source file) -->
                <Border Grid.Row="0"
                        Background="#101C33"
                        BorderBrush="#1C2A40"
                        BorderThickness="0,0,0,1"
                        Padding="18,14"
                        IsVisible="{Binding ShowSourceFile}">
                  <Grid ColumnDefinitions="1.2*,2*,1.2*,1.6*,1.3*,1.2*,2.5*,Auto"
                        ColumnSpacing="12">
                    <Button Grid.Column="0" Content="{Binding DateHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Date"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="1" Content="{Binding DescriptionHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Description"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="2" Content="{Binding AmountHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Amount"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                            HorizontalAlignment="Right" HorizontalContentAlignment="Right"/>
                    <Button Grid.Column="3" Content="{Binding CategoryHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Category"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                            Margin="8,0,0,0"/>
                    <Button Grid.Column="4" Content="{Binding AccountHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Account"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="5" Content="{Binding StatusHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="Status"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                            HorizontalAlignment="Center" HorizontalContentAlignment="Center"/>
                    <Button Grid.Column="6" Content="{Binding SourceFileHeader}"
                            Command="{Binding SortByColumnCommand}" CommandParameter="SourceFile"
                            Classes="muted" FontWeight="SemiBold"
                            Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"/>
                    <Button Grid.Column="7" Content="{Binding NotesHeader}"
                               Command="{Binding SortByColumnCommand}" CommandParameter="Notes"
                               Classes="muted" FontWeight="SemiBold"
                               Background="Transparent" BorderThickness="0" Padding="0" Cursor="Hand"
                               HorizontalAlignment="Center"
                               Width="54"/>
                  </Grid>
                </Border>

                <!-- Scrollable rows (without source file) -->
                <Border Grid.Row="1"
                        Padding="0"
                        MaxHeight="480"
                        IsVisible="{Binding !ShowSourceFile}">
                  <ListBox ItemsSource="{Binding FilteredRows}"
                           Background="Transparent"
                           BorderThickness="0"
                           ScrollViewer.VerticalScrollBarVisibility="Auto"
                           ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                    <ListBox.Styles>
                      <Style Selector="ListBox">
                        <Setter Property="Padding" Value="0"/>
                      </Style>
                      <Style Selector="ListBoxItem">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Background" Value="Transparent"/>
                      </Style>
                      <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                        <Setter Property="Background" Value="#0D1B33"/>
                      </Style>
                    </ListBox.Styles>

                    <ListBox.ItemTemplate>
                      <DataTemplate>
                        <Border BorderBrush="#1C2A40"
                                BorderThickness="0,0,0,1"
                                Padding="18,8">
                          <Grid ColumnDefinitions="1.2*,2.5*,1.2*,1.8*,1.5*,1.3*,Auto"
                                ColumnSpacing="12"
                                VerticalAlignment="Center">
                            <Button Grid.Column="0" Background="Transparent" BorderThickness="0"
                                    Padding="0" Cursor="Hand"
                                    Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding DateText}"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Center">
                              <TextBlock Text="{Binding DateText}"
                                         FontWeight="SemiBold" FontSize="13"/>
                            </Button>
                            <Panel Grid.Column="1" Background="Transparent">
                              <Panel.Styles>
                                <Style Selector="Panel > Button.copyBtn">
                                  <Setter Property="IsVisible" Value="False"/>
                                </Style>
                                <Style Selector="Panel:pointerover > Button.copyBtn">
                                  <Setter Property="IsVisible" Value="True"/>
                                </Style>
                              </Panel.Styles>
                              <Button Background="Transparent" BorderThickness="0"
                                      Padding="0" Cursor="Hand"
                                      Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding Description}"
                                      HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"
                                      VerticalAlignment="Center">
                                <TextBlock Text="{Binding Description}"
                                           TextTrimming="CharacterEllipsis"
                                           FontWeight="SemiBold" FontSize="13"/>
                              </Button>
                              <Button Classes="copyBtn"
                                      Background="#1C2A40" BorderThickness="0"
                                      Width="24" Height="24" Padding="0"
                                      CornerRadius="4" Cursor="Hand"
                                      HorizontalAlignment="Right" VerticalAlignment="Center"
                                      Click="CopyDescription"
                                      ToolTip.Tip="Copy">
                                <Button.Styles>
                                  <Style Selector="Button:pointerover">
                                    <Setter Property="Background" Value="#2A3A54"/>
                                  </Style>
                                </Button.Styles>
                                <PathIcon Width="12" Height="12" Foreground="#A7B4D1"
                                          Data="M4,2 L4,0 L14,0 L14,10 L12,10 L12,2 Z M0,4 L10,4 L10,14 L0,14 Z M2,6 L8,6 L8,12 L2,12 Z"/>
                              </Button>
                            </Panel>
                            <Button Grid.Column="2" Background="Transparent" BorderThickness="0"
                                    Padding="0" Cursor="Hand"
                                    Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding AmountText}"
                                    HorizontalAlignment="Right" VerticalAlignment="Center">
                              <TextBlock Text="{Binding AmountText}"
                                         FontWeight="Bold" FontSize="13"
                                         Foreground="{Binding AmountColor}"/>
                            </Button>
                            <ComboBox Grid.Column="3"
                                      ItemsSource="{Binding CategoryOptions}"
                                      SelectedItem="{Binding SelectedCategory}"
                                      Background="#121C30" BorderBrush="#1C2A40" BorderThickness="1"
                                      CornerRadius="10" Padding="8,4" Margin="8,0,0,0"
                                      FontSize="12" FontWeight="SemiBold"
                                      HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                            <Button Grid.Column="4" Background="Transparent" BorderThickness="0"
                                    Padding="0" Cursor="Hand"
                                    Command="{Binding ClickAccountCommand}"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Center">
                              <TextBlock Text="{Binding Account}"
                                         Classes="muted" FontWeight="SemiBold" FontSize="12"
                                         TextTrimming="CharacterEllipsis"/>
                            </Button>
                            <ComboBox Grid.Column="5"
                                      ItemsSource="{Binding StatusOptions}"
                                      SelectedItem="{Binding SelectedStatus}"
                                      Background="#0B1527" BorderBrush="#1C2A40" BorderThickness="1"
                                      CornerRadius="10" Padding="6,3" FontSize="11" FontWeight="SemiBold"
                                      Foreground="{Binding StatusColor}"
                                      HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                            <!-- Notes icon with flyout -->
                            <Button Grid.Column="6"
                                    Background="Transparent" BorderThickness="0"
                                    Padding="4" Cursor="Hand"
                                    Width="28" HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                              <Button.Styles>
                                <Style Selector="Button">
                                  <Setter Property="Opacity" Value="0.4"/>
                                </Style>
                                <Style Selector="Button:pointerover">
                                  <Setter Property="Opacity" Value="1"/>
                                </Style>
                              </Button.Styles>
                              <Panel>
                                <TextBlock Text="ðŸ“" FontSize="14"/>
                                <Border Background="#3FA97A" CornerRadius="4" Width="8" Height="8"
                                        HorizontalAlignment="Right" VerticalAlignment="Top"
                                        Margin="0,-2,-2,0"
                                        IsVisible="{Binding HasNotes}"/>
                              </Panel>
                              <Button.Flyout>
                                <Flyout Placement="LeftEdgeAlignedTop">
                                  <Border Width="300" Padding="4">
                                    <StackPanel Spacing="8">
                                      <TextBlock Text="Notes" FontWeight="Bold" FontSize="14"/>
                                      <TextBox Text="{Binding Notes}"
                                               Watermark="Add searchable keywords like refund, business, gift..."
                                               AcceptsReturn="True"
                                               TextWrapping="Wrap"
                                               Height="100"
                                               CornerRadius="8"
                                               Padding="10,8"
                                               FontSize="13"/>
                                      <Panel HorizontalAlignment="Right">
                                        <Button Content="Done"
                                                Background="#555555" Foreground="White"
                                                IsVisible="{Binding !HasNotes}"
                                                Padding="16,6"
                                                CornerRadius="6"
                                                FontSize="13"
                                                Click="CloseNotesFlyout"/>
                                        <Button Content="Done"
                                                Background="#1E90FF" Foreground="White"
                                                IsVisible="{Binding HasNotes}"
                                                Padding="16,6"
                                                CornerRadius="6"
                                                FontSize="13"
                                                Click="CloseNotesFlyout"/>
                                      </Panel>
                                    </StackPanel>
                                  </Border>
                                </Flyout>
                              </Button.Flyout>
                            </Button>
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ListBox.ItemTemplate>
                  </ListBox>
                </Border>

                <!-- Scrollable rows (with source file) -->
                <Border Grid.Row="1"
                        Padding="0"
                        MaxHeight="480"
                        IsVisible="{Binding ShowSourceFile}">
                  <ListBox ItemsSource="{Binding FilteredRows}"
                           Background="Transparent"
                           BorderThickness="0"
                           ScrollViewer.VerticalScrollBarVisibility="Auto"
                           ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                    <ListBox.Styles>
                      <Style Selector="ListBox">
                        <Setter Property="Padding" Value="0"/>
                      </Style>
                      <Style Selector="ListBoxItem">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Background" Value="Transparent"/>
                      </Style>
                      <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                        <Setter Property="Background" Value="#0D1B33"/>
                      </Style>
                    </ListBox.Styles>

                    <ListBox.ItemTemplate>
                      <DataTemplate>
                        <Border BorderBrush="#1C2A40"
                                BorderThickness="0,0,0,1"
                                Padding="18,8">
                          <Grid ColumnDefinitions="1.2*,2*,1.2*,1.6*,1.3*,1.2*,2.5*,Auto"
                                ColumnSpacing="12"
                                VerticalAlignment="Center">
                            <Button Grid.Column="0" Background="Transparent" BorderThickness="0"
                                    Padding="0" Cursor="Hand"
                                    Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding DateText}"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Center">
                              <TextBlock Text="{Binding DateText}"
                                         FontWeight="SemiBold" FontSize="13"/>
                            </Button>
                            <Panel Grid.Column="1" Background="Transparent">
                              <Panel.Styles>
                                <Style Selector="Panel > Button.copyBtn">
                                  <Setter Property="IsVisible" Value="False"/>
                                </Style>
                                <Style Selector="Panel:pointerover > Button.copyBtn">
                                  <Setter Property="IsVisible" Value="True"/>
                                </Style>
                              </Panel.Styles>
                              <Button Background="Transparent" BorderThickness="0"
                                      Padding="0" Cursor="Hand"
                                      Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding Description}"
                                      HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"
                                      VerticalAlignment="Center">
                                <TextBlock Text="{Binding Description}"
                                           TextTrimming="CharacterEllipsis"
                                           FontWeight="SemiBold" FontSize="13"/>
                              </Button>
                              <Button Classes="copyBtn"
                                      Background="#1C2A40" BorderThickness="0"
                                      Width="24" Height="24" Padding="0"
                                      CornerRadius="4" Cursor="Hand"
                                      HorizontalAlignment="Right" VerticalAlignment="Center"
                                      Click="CopyDescription"
                                      ToolTip.Tip="Copy">
                                <Button.Styles>
                                  <Style Selector="Button:pointerover">
                                    <Setter Property="Background" Value="#2A3A54"/>
                                  </Style>
                                </Button.Styles>
                                <PathIcon Width="12" Height="12" Foreground="#A7B4D1"
                                          Data="M4,2 L4,0 L14,0 L14,10 L12,10 L12,2 Z M0,4 L10,4 L10,14 L0,14 Z M2,6 L8,6 L8,12 L2,12 Z"/>
                              </Button>
                            </Panel>
                            <Button Grid.Column="2" Background="Transparent" BorderThickness="0"
                                    Padding="0" Cursor="Hand"
                                    Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding AmountText}"
                                    HorizontalAlignment="Right" VerticalAlignment="Center">
                              <TextBlock Text="{Binding AmountText}"
                                         FontWeight="Bold" FontSize="13"
                                         Foreground="{Binding AmountColor}"/>
                            </Button>
                            <ComboBox Grid.Column="3"
                                      ItemsSource="{Binding CategoryOptions}"
                                      SelectedItem="{Binding SelectedCategory}"
                                      Background="#121C30" BorderBrush="#1C2A40" BorderThickness="1"
                                      CornerRadius="10" Padding="8,4" Margin="8,0,0,0"
                                      FontSize="12" FontWeight="SemiBold"
                                      HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                            <Button Grid.Column="4" Background="Transparent" BorderThickness="0"
                                    Padding="0" Cursor="Hand"
                                    Command="{Binding ClickAccountCommand}"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Center">
                              <TextBlock Text="{Binding Account}"
                                         Classes="muted" FontWeight="SemiBold" FontSize="12"
                                         TextTrimming="CharacterEllipsis"/>
                            </Button>
                            <ComboBox Grid.Column="5"
                                      ItemsSource="{Binding StatusOptions}"
                                      SelectedItem="{Binding SelectedStatus}"
                                      Background="#0B1527" BorderBrush="#1C2A40" BorderThickness="1"
                                      CornerRadius="10" Padding="6,3" FontSize="11" FontWeight="SemiBold"
                                      Foreground="{Binding StatusColor}"
                                      HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                            <Panel Grid.Column="6" Background="Transparent">
                              <Panel.Styles>
                                <Style Selector="Panel > StackPanel.actionBtns">
                                  <Setter Property="IsVisible" Value="False"/>
                                </Style>
                                <Style Selector="Panel:pointerover > StackPanel.actionBtns">
                                  <Setter Property="IsVisible" Value="True"/>
                                </Style>
                              </Panel.Styles>
                              <Button Background="Transparent" BorderThickness="0"
                                      Padding="0" Cursor="Hand"
                                      Command="{Binding ClickToSearchCommand}" CommandParameter="{Binding SourceFile}"
                                      HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"
                                      VerticalAlignment="Center">
                                <TextBlock Text="{Binding SourceFile}"
                                           Classes="muted" FontSize="11"
                                           TextTrimming="CharacterEllipsis"/>
                              </Button>
                              <StackPanel Classes="actionBtns" Orientation="Horizontal" Spacing="4"
                                          HorizontalAlignment="Right" VerticalAlignment="Center">
                                <Button Background="#1C2A40" BorderThickness="0"
                                        Width="24" Height="24" Padding="0"
                                        CornerRadius="4" Cursor="Hand"
                                        Click="OpenSourceFileFolder"
                                        ToolTip.Tip="Open file">
                                  <Button.Styles>
                                    <Style Selector="Button:pointerover">
                                      <Setter Property="Background" Value="#2A3A54"/>
                                    </Style>
                                  </Button.Styles>
                                  <PathIcon Width="12" Height="12" Foreground="#A7B4D1"
                                            Data="M1,3 L5,3 L7,1 L13,1 L13,11 L1,11 Z M2,5 L12,5 L12,10 L2,10 Z"/>
                                </Button>
                                <Button Background="#1C2A40" BorderThickness="0"
                                        Width="24" Height="24" Padding="0"
                                        CornerRadius="4" Cursor="Hand"
                                        Click="CopySourceFile"
                                        ToolTip.Tip="Copy">
                                  <Button.Styles>
                                    <Style Selector="Button:pointerover">
                                      <Setter Property="Background" Value="#2A3A54"/>
                                    </Style>
                                  </Button.Styles>
                                  <PathIcon Width="12" Height="12" Foreground="#A7B4D1"
                                            Data="M4,2 L4,0 L14,0 L14,10 L12,10 L12,2 Z M0,4 L10,4 L10,14 L0,14 Z M2,6 L8,6 L8,12 L2,12 Z"/>
                                </Button>
                              </StackPanel>
                            </Panel>
                            <!-- Notes icon with flyout -->
                            <Button Grid.Column="7"
                                    Background="Transparent" BorderThickness="0"
                                    Padding="4" Cursor="Hand"
                                    Width="28" HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                              <Button.Styles>
                                <Style Selector="Button">
                                  <Setter Property="Opacity" Value="0.4"/>
                                </Style>
                                <Style Selector="Button:pointerover">
                                  <Setter Property="Opacity" Value="1"/>
                                </Style>
                              </Button.Styles>
                              <Panel>
                                <TextBlock Text="ðŸ“" FontSize="14"/>
                                <Border Background="#3FA97A" CornerRadius="4" Width="8" Height="8"
                                        HorizontalAlignment="Right" VerticalAlignment="Top"
                                        Margin="0,-2,-2,0"
                                        IsVisible="{Binding HasNotes}"/>
                              </Panel>
                              <Button.Flyout>
                                <Flyout Placement="LeftEdgeAlignedTop">
                                  <Border Width="300" Padding="4">
                                    <StackPanel Spacing="8">
                                      <TextBlock Text="Notes" FontWeight="Bold" FontSize="14"/>
                                      <TextBox Text="{Binding Notes}"
                                               Watermark="Add searchable keywords like refund, business, gift..."
                                               AcceptsReturn="True"
                                               TextWrapping="Wrap"
                                               Height="100"
                                               CornerRadius="8"
                                               Padding="10,8"
                                               FontSize="13"/>
                                      <Panel HorizontalAlignment="Right">
                                        <Button Content="Done"
                                                Background="#555555" Foreground="White"
                                                IsVisible="{Binding !HasNotes}"
                                                Padding="16,6"
                                                CornerRadius="6"
                                                FontSize="13"
                                                Click="CloseNotesFlyout"/>
                                        <Button Content="Done"
                                                Background="#1E90FF" Foreground="White"
                                                IsVisible="{Binding HasNotes}"
                                                Padding="16,6"
                                                CornerRadius="6"
                                                FontSize="13"
                                                Click="CloseNotesFlyout"/>
                                      </Panel>
                                    </StackPanel>
                                  </Border>
                                </Flyout>
                              </Button.Flyout>
                            </Button>
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ListBox.ItemTemplate>
                  </ListBox>
                </Border>

              </Grid>
            </Border>

          </StackPanel>
        </Border>

      </Grid>
    </Border>
  </ScrollViewer>

  <!-- Custom Date Range dialog overlay -->
  <Border Background="#80000000"
          IsVisible="{Binding IsCustomDateDialogOpen}"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch">
    <Border Background="#0F1A2E"
            BorderBrush="#1C2A40"
            BorderThickness="1"
            CornerRadius="18"
            Padding="28,24"
            MaxWidth="420"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
      <StackPanel Spacing="18">

        <TextBlock Text="Custom Date Range"
                   FontSize="20"
                   FontWeight="Bold"/>

        <StackPanel Spacing="6">
          <TextBlock Text="From"
                     Classes="muted"
                     FontWeight="SemiBold"/>
          <DatePicker SelectedDate="{Binding CustomDateFrom}"
                      CornerRadius="10"
                      HorizontalAlignment="Stretch"/>
        </StackPanel>

        <StackPanel Spacing="6">
          <TextBlock Text="To"
                     Classes="muted"
                     FontWeight="SemiBold"/>
          <DatePicker SelectedDate="{Binding CustomDateTo}"
                      CornerRadius="10"
                      HorizontalAlignment="Stretch"/>
        </StackPanel>

        <Grid ColumnDefinitions="*,*"
              ColumnSpacing="12">
          <Button Grid.Column="0"
                  Classes="secondaryWide"
                  Command="{Binding CancelCustomDateRange}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            Cancel
          </Button>
          <Button Grid.Column="1"
                  Classes="primaryWide"
                  Command="{Binding ApplyCustomDateRange}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            Apply
          </Button>
        </Grid>

      </StackPanel>
    </Border>
  </Border>

  <!-- New Category dialog overlay -->
  <Border Background="#80000000"
          IsVisible="{Binding IsNewCategoryDialogOpen}"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch">
    <Border Background="#0F1A2E"
            BorderBrush="#1C2A40"
            BorderThickness="1"
            CornerRadius="18"
            Padding="28,24"
            MaxWidth="420"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
      <StackPanel Spacing="18">

        <TextBlock Text="Add New Category"
                   FontSize="20"
                   FontWeight="Bold"/>

        <!-- Name -->
        <StackPanel Spacing="6">
          <TextBlock Text="Category Name"
                     Classes="muted"
                     FontWeight="SemiBold"/>
          <TextBox Text="{Binding NewCategoryName}"
                   Watermark="Enter category name..."
                   CornerRadius="10"
                   Padding="12,10"/>
        </StackPanel>

        <!-- Type -->
        <StackPanel Spacing="6">
          <TextBlock Text="Category Type"
                     Classes="muted"
                     FontWeight="SemiBold"/>
          <ComboBox ItemsSource="{Binding CategoryTypes}"
                    SelectedItem="{Binding SelectedNewCategoryType}"
                    CornerRadius="10"
                    Padding="10,8"
                    HorizontalAlignment="Stretch"/>
        </StackPanel>

        <!-- Buttons -->
        <Grid ColumnDefinitions="*,*"
              ColumnSpacing="12">
          <Button Grid.Column="0"
                  Classes="secondaryWide"
                  Command="{Binding CancelNewCategory}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            Cancel
          </Button>
          <Button Grid.Column="1"
                  Classes="primaryWide"
                  Command="{Binding ConfirmNewCategory}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            Create
          </Button>
        </Grid>

      </StackPanel>
    </Border>
  </Border>

  </Grid>
</UserControl>

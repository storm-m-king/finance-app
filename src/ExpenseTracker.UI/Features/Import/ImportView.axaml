<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:svg="clr-namespace:Avalonia.Svg.Skia;assembly=Avalonia.Svg.Skia"
             xmlns:shapes="clr-namespace:Avalonia.Controls.Shapes;assembly=Avalonia.Controls"
             x:Class="ExpenseTracker.UI.Features.Import.ImportView">

  <ScrollViewer VerticalScrollBarVisibility="Auto"
                HorizontalScrollBarVisibility="Disabled">

    <Border Padding="0,0,12,24">
      <Grid RowDefinitions="Auto,Auto,Auto"
            RowSpacing="18">

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="6">
          <TextBlock Text="Import Transactions"
                     FontSize="32"
                     FontWeight="Bold" />
          <TextBlock Text="Import transactions from CSV files"
                     Classes="muted" />
        </StackPanel>

        <!-- Stepper card -->
        <Border Grid.Row="1" Classes="card">
          <Grid ColumnDefinitions="Auto,*,Auto,*,Auto"
                VerticalAlignment="Center"
                Margin="6">

            <!-- 1 -->
            <StackPanel Grid.Column="0" Spacing="8">
              <Border Width="36" Height="36"
                      CornerRadius="18"
                      BorderBrush="{DynamicResource Blue}"
                      BorderThickness="2"
                      Background="Transparent"
                      HorizontalAlignment="Left">
                <TextBlock Text="1"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>
              </Border>
              <TextBlock Text="Upload File"
                         FontWeight="SemiBold"/>
            </StackPanel>

            <Border Grid.Column="1"
                    Height="2"
                    Background="#223A66"
                    VerticalAlignment="Center"
                    Margin="18,0"/>

            <!-- 2 -->
            <StackPanel Grid.Column="2" Spacing="8" Opacity="0.7">
              <Border Width="36" Height="36"
                      CornerRadius="18"
                      BorderBrush="#3A4A66"
                      BorderThickness="2"
                      Background="Transparent"
                      HorizontalAlignment="Center">
                <TextBlock Text="2"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>
              </Border>
              <TextBlock Text="Preview &amp; Map"
                         HorizontalAlignment="Center"
                         FontWeight="SemiBold"/>
            </StackPanel>

            <Border Grid.Column="3"
                    Height="2"
                    Background="#223A66"
                    VerticalAlignment="Center"
                    Margin="18,0"/>

            <!-- 3 -->
            <StackPanel Grid.Column="4" Spacing="8" Opacity="0.7">
              <Border Width="36" Height="36"
                      CornerRadius="18"
                      BorderBrush="#3A4A66"
                      BorderThickness="2"
                      Background="Transparent"
                      HorizontalAlignment="Right">
                <TextBlock Text="3"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>
              </Border>
              <TextBlock Text="Complete"
                         HorizontalAlignment="Right"
                         FontWeight="SemiBold"/>
            </StackPanel>

          </Grid>
        </Border>

        <!-- Main import card -->
        <Border Grid.Row="2" Classes="card">
          <StackPanel Spacing="18">

            <!-- Icon + title -->
            <StackPanel Spacing="8" HorizontalAlignment="Center">
              <Border Width="76" Height="76"
                      CornerRadius="38"
                      Background="#0D2A5A"
                      HorizontalAlignment="Center">
                <svg:Svg Width="34" Height="34"
                         Path="/Assets/Icons/import.svg"
                         Stretch="Uniform"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"/>
              </Border>

              <TextBlock Text="Upload CSV File"
                         FontSize="22"
                         FontWeight="Bold"
                         HorizontalAlignment="Center"/>

              <TextBlock Text="Select a CSV file to import your transactions"
                         Classes="muted"
                         HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Center column so the drop zone + form align like the mock -->
            <StackPanel Spacing="14"
                        HorizontalAlignment="Center"
                        MaxWidth="860"
                        Width="860">

              <!-- Drop zone -->
              <Border Classes="dropZone"
                      Height="220"
                      CornerRadius="18"
                      Background="#0B1220"
                      BorderBrush="#1C2A40"
                      BorderThickness="1"
                      HorizontalAlignment="Stretch"
                      DragDrop.AllowDrop="True"
                      DragDrop.DragOver="DropZone_OnDragOver"
                      DragDrop.Drop="DropZone_OnDrop">
                <Grid>

                  <!-- dashed outline -->
                  <shapes:Rectangle Margin="22"
                                    RadiusX="14"
                                    RadiusY="14"
                                    Classes="dropOutline"
                                    StrokeThickness="2"
                                    StrokeDashArray="4,4"
                                    Fill="Transparent"/>


                  <!-- centered content -->
                  <StackPanel Spacing="10"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center">
                    <svg:Svg Width="42" Height="42"
                             Path="/Assets/Icons/file.svg"
                             Stretch="Uniform"
                             HorizontalAlignment="Center"/>

                    <TextBlock Text="Click to upload or drag and drop"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"/>

                    <TextBlock Text="CSV files only"
                               Classes="muted"
                               HorizontalAlignment="Center"/>
                  </StackPanel>

                  <!-- click target -->
                  <Button Background="Transparent"
                          BorderThickness="0"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          Command="{Binding PickFile}"/>
                </Grid>
              </Border>

              <!-- NEW: Selected file “chip” UNDER the drop zone -->
              <Border IsVisible="{Binding HasSelectedFile}"
                      CornerRadius="14"
                      Background="#101C33"
                      BorderBrush="#1C2A40"
                      BorderThickness="1"
                      Padding="14,10"
                      HorizontalAlignment="Stretch">

                <Grid ColumnDefinitions="Auto,12,*,Auto"
                      VerticalAlignment="Center">

                  <!-- left icon -->
                  <svg:Svg Grid.Column="0"
                           Width="18" Height="18"
                           Path="/Assets/Icons/file.svg"
                           Stretch="Uniform"/>

                  <!-- filename -->
                  <TextBlock Grid.Column="2"
                             Text="{Binding SelectedFileName}"
                             FontWeight="SemiBold"
                             VerticalAlignment="Center"/>

                  <!-- right “success” indicator -->
                  <!-- Option A: use an SVG if you have it -->
                  <!-- <svg:Svg Grid.Column="3" Width="18" Height="18" Path="/Assets/Icons/check-circle.svg" Stretch="Uniform"/> -->

                  <!-- Option B: just use a text checkmark (works immediately) -->
                  <TextBlock Grid.Column="3"
                             Text="✓"
                             FontSize="18"
                             FontWeight="Bold"
                             Foreground="#20D07A"
                             VerticalAlignment="Center"/>
                </Grid>

              </Border>

              <!-- Mapping profile + CTA: full width (matches drop zone) -->
              <StackPanel Spacing="10"
                          HorizontalAlignment="Stretch">

                <TextBlock Text="Select Mapping ImportProfile"
                           FontWeight="SemiBold"/>

                <ComboBox ItemsSource="{Binding MappingProfiles}"
                          SelectedItem="{Binding SelectedMappingProfile}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Left"/>

                <Button Classes="primaryWide"
                        Command="{Binding ContinueToPreview}"
                        IsEnabled="{Binding CanContinue}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center">
                  Continue to Preview
                </Button>

              </StackPanel>

            </StackPanel>

          </StackPanel>
        </Border>

      </Grid>
    </Border>
  </ScrollViewer>
</UserControl>
